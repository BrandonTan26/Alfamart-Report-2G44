<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Laporan Per Shift - KP Garung Tambak</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg-main: #050509;
      --bg-card: #121219;
      --bg-card-soft: #171720;
      --text-main: #f5f5f5;
      --text-muted: #aaaaaa;
      --neon-red: #ff0033;
      --neon-yellow: #ffd300;
      --border-soft: #2a2a36;
      --shadow-soft: 0 0 18px rgba(255, 0, 51, 0.25);
      --shadow-yellow: 0 0 20px rgba(255, 211, 0, 0.35);
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      --font-mono: "SF Mono", Menlo, Monaco, Consolas, "Courier New", monospace;
    }

    body.light {
      --bg-main: #f7f7fb;
      --bg-card: #ffffff;
      --bg-card-soft: #ffffff;
      --text-main: #181818;
      --text-muted: #666666;
      --border-soft: #e0e0ea;
      --shadow-soft: 0 0 14px rgba(255, 0, 51, 0.15);
      --shadow-yellow: 0 0 16px rgba(255, 211, 0, 0.25);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      background: radial-gradient(circle at top left, rgba(255, 0, 51, 0.2), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(255, 211, 0, 0.2), transparent 55%),
                  var(--bg-main);
      font-family: var(--font-main);
      color: var(--text-main);
      transition: background 0.3s ease, color 0.3s ease;
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto 40px auto;
    }

    /* HEADER */

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    .brand-block {
      display: flex;
      gap: 14px;
      align-items: center;
    }

    .logo-alfamart {
      padding: 8px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: radial-gradient(circle at top left, rgba(255, 0, 51, 0.45), transparent 60%),
                  radial-gradient(circle at bottom right, rgba(255, 211, 0, 0.45), transparent 60%),
                  linear-gradient(135deg, #1c1c24, #050509);
      box-shadow: var(--shadow-soft);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-alfamart span {
      font-weight: 900;
      letter-spacing: 0.13em;
      font-size: 11px;
      text-transform: uppercase;
      background: linear-gradient(90deg, var(--neon-red), var(--neon-yellow));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow:
        0 0 6px rgba(255, 0, 51, 0.8),
        0 0 12px rgba(255, 211, 0, 0.7);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title {
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--text-main);
      text-shadow:
        0 0 10px rgba(0, 0, 0, 0.7),
        0 0 20px rgba(255, 0, 51, 0.7);
    }

    .brand-sub {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .toggle-theme {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(5, 5, 10, 0.7);
      backdrop-filter: blur(10px);
      cursor: pointer;
      font-size: 11px;
      color: var(--text-muted);
    }

    body.light .toggle-theme {
      background: rgba(255, 255, 255, 0.95);
    }

    .toggle-pill {
      width: 40px;
      height: 18px;
      border-radius: 999px;
      background: radial-gradient(circle at 20% 20%, var(--neon-yellow), transparent 70%),
                  rgba(15, 15, 20, 1);
      position: relative;
      border: 1px solid rgba(255, 211, 0, 0.7);
      box-shadow: var(--shadow-yellow);
    }

    .toggle-knob {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      background: #111;
      position: absolute;
      top: 1px;
      left: 2px;
      transition: transform 0.25s ease, background 0.25s ease, box-shadow 0.25s ease;
      box-shadow: 0 0 6px rgba(255, 211, 0, 0.9);
    }

    body.light .toggle-knob {
      transform: translateX(20px);
      background: #fff5c0;
      box-shadow: 0 0 9px rgba(255, 211, 0, 0.9);
    }

    .divider-neon {
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, transparent, var(--neon-red), var(--neon-yellow), transparent);
      box-shadow:
        0 0 12px rgba(255, 0, 51, 0.7),
        0 0 10px rgba(255, 211, 0, 0.7);
      margin-bottom: 12px;
      opacity: 0.9;
    }

    /* CARDS & LAYOUT */

    .card {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.02), rgba(0, 0, 0, 0.65));
      border-radius: 16px;
      padding: 14px 14px 12px 14px;
      border: 1px solid var(--border-soft);
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.5);
      margin-bottom: 12px;
    }

    body.light .card {
      background: var(--bg-card);
      box-shadow: 0 4px 14px rgba(0, 0, 0, 0.12);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .card-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      color: var(--text-muted);
    }

    .card-title strong {
      color: var(--neon-yellow);
    }

    .badge-kpi {
      font-size: 10px;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      color: var(--text-muted);
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 8px 12px;
    }

    @media (max-width: 720px) {
      .header {
        flex-direction: column;
        align-items: flex-start;
      }
      .grid-2 {
        grid-template-columns: 1fr;
      }
    }

    label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      margin-bottom: 4px;
      display: block;
      color: var(--text-muted);
    }

    input[type="text"],
    input[type="number"],
    input[type="date"] {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: rgba(5, 5, 10, 0.85);
      color: var(--text-main);
      font-size: 12px;
      outline: none;
      transition: border 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    }

    body.light input[type="text"],
    body.light input[type="number"],
    body.light input[type="date"] {
      background: #fafafa;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    input[type="date"]:focus {
      border-color: var(--neon-yellow);
      box-shadow: 0 0 12px rgba(255, 211, 0, 0.5);
    }

    input[readonly] {
      opacity: 0.7;
      cursor: default;
      background: rgba(40, 40, 50, 0.8);
    }

    body.light input[readonly] {
      background: #f0f0f5;
    }

    .note {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .kpi-row {
      border-left: 3px solid var(--neon-red);
      padding-left: 10px;
    }

    .kpi-row.yellow {
      border-left-color: var(--neon-yellow);
    }

    .kpi-name {
      font-size: 13px;
      font-weight: 700;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      margin-bottom: 6px;
      color: var(--neon-yellow);
      text-shadow:
        0 0 8px rgba(255, 211, 0, 0.9),
        0 0 12px rgba(255, 0, 51, 0.7);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    button {
      border: none;
      cursor: pointer;
      font-size: 12px;
      padding: 8px 14px;
      border-radius: 999px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.15s ease, box-shadow 0.15s ease, background 0.15s ease, opacity 0.15s ease;
    }

    button span.icon {
      font-size: 13px;
    }

    button.btn-red {
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.15), transparent 60%),
                  linear-gradient(135deg, #ff0033, #b80024);
      color: #fff;
      box-shadow: 0 0 16px rgba(255, 0, 51, 0.7);
    }

    button.btn-yellow {
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.16), transparent 60%),
                  linear-gradient(135deg, #ffd300, #b79200);
      color: #201400;
      box-shadow: 0 0 16px rgba(255, 211, 0, 0.7);
    }

    button.btn-wa {
      background: radial-gradient(circle at top left, rgba(255, 255, 255, 0.16), transparent 60%),
                  linear-gradient(135deg, #00c96f, #008c48);
      color: #f5fff9;
      box-shadow: 0 0 16px rgba(0, 201, 111, 0.8);
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 0 18px rgba(0, 0, 0, 0.4);
      opacity: 0.96;
    }

    button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: none;
      opacity: 0.9;
    }

    textarea {
      width: 100%;
      min-height: 260px;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      background:
        linear-gradient(135deg, rgba(255, 0, 51, 0.05), transparent 70%),
        radial-gradient(circle at bottom right, rgba(255, 211, 0, 0.05), transparent 70%),
        rgba(5, 5, 12, 0.96);
      color: var(--text-main);
      font-size: 12px;
      font-family: var(--font-mono);
      white-space: pre-wrap;
      resize: vertical;
      outline: none;
    }

    body.light textarea {
      background:
        linear-gradient(135deg, rgba(255, 0, 51, 0.02), transparent 70%),
        radial-gradient(circle at bottom right, rgba(255, 211, 0, 0.07), transparent 70%),
        #fdfdfd;
    }

    .footer {
      margin-top: 22px;
      padding-top: 10px;
      border-top: 1px solid rgba(255, 255, 255, 0.12);
      text-align: center;
      font-size: 11px;
      color: var(--text-muted);
    }

    .footer-main {
      margin-bottom: 3px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      background: linear-gradient(90deg, var(--neon-yellow), var(--neon-red));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow:
        0 0 10px rgba(255, 211, 0, 0.9),
        0 0 16px rgba(255, 0, 51, 0.7);
    }

    .footer-sub {
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .pill-status {
      display: inline-flex;
      align-items: center;
      padding: 2px 10px;
      font-size: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.16);
      margin-left: 4px;
    }

    .pill-status.lunas {
      border-color: rgba(0, 255, 128, 0.7);
      color: #76ffb2;
      box-shadow: 0 0 10px rgba(0, 255, 128, 0.6);
    }

    .pill-status.hutang {
      border-color: rgba(255, 0, 51, 0.7);
      color: #ff9da9;
      box-shadow: 0 0 8px rgba(255, 0, 51, 0.7);
    }

    .status-bar {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .status-bar span.label {
      text-transform: uppercase;
      letter-spacing: 0.16em;
      font-size: 10px;
    }
  </style>
</head>
<body class="dark">
  <div class="wrap">
    <!-- HEADER -->
    <div class="header">
      <div class="brand-block">
        <div class="logo-alfamart">
          <span>ALFAMART</span>
        </div>
        <div class="brand-text">
          <div class="brand-title">KP GARUNG TAMBAK</div>
          <div class="brand-sub">Laporan Per Shift Â· Cyber Retail Template</div>
        </div>
      </div>

      <button class="toggle-theme" id="themeToggle" type="button">
        <div class="toggle-pill">
          <div class="toggle-knob"></div>
        </div>
        <span class="mode-label">Dark Mode</span>
      </button>
    </div>

    <div class="divider-neon"></div>

    <!-- DATA UMUM -->
    <div class="card">
      <div class="card-header">
        <div class="card-title"><strong>Input Laporan</strong> Â· Data Umum Shift</div>
        <span class="badge-kpi">KP GARUNG TAMBAK</span>
      </div>
      <div class="grid-2">
        <div>
          <label>Nama Toko</label>
          <input type="text" id="namaToko" value="KP GARUNG TAMBAK" />
        </div>
        <div>
          <label>Tanggal</label>
          <input type="date" id="tanggal" />
        </div>
        <div>
          <label>COS</label>
          <input type="text" id="cos" value="BRANDO" />
        </div>
        <div>
          <label>Nama Kasir</label>
          <input type="text" id="namaKasir" placeholder="Isi nama kasir" />
        </div>
        <div>
          <label>AC</label>
          <input type="text" id="ac" placeholder="Isi nama AC" />
        </div>
        <div>
          <label>Shift</label>
          <input type="number" id="shift" min="1" max="3" placeholder="1 / 2" />
        </div>
      </div>
      <p class="note">
        Catatan: Target KPI di bawah <strong>fix</strong> dari toko. Anak-anak cukup isi
        <strong>ACTUAL</strong> dan data umum saja. ACV & status hutang akan dihitung otomatis.
      </p>
    </div>

    <!-- PSM -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">KPI Â· <strong>PSM</strong></div>
        <span class="badge-kpi">Up-Selling</span>
      </div>
      <div class="kpi-row">
        <div class="kpi-name">PSM</div>
        <div class="grid-2">
          <div>
            <label>Target Shift 1</label>
            <input type="number" id="psmTarget1" value="15" readonly />
          </div>
          <div>
            <label>Target Shift 2</label>
            <input type="number" id="psmTarget2" value="25" readonly />
          </div>
          <div>
            <label>ACTUAL (total sehari)</label>
            <input type="number" id="psmActual" placeholder="Isi total PSM" />
          </div>
        </div>
      </div>
    </div>

    <!-- PWP -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">KPI Â· <strong>PWP</strong></div>
        <span class="badge-kpi">Bundling</span>
      </div>
      <div class="kpi-row yellow">
        <div class="kpi-name">PWP</div>
        <div class="grid-2">
          <div>
            <label>Target Shift 1</label>
            <input type="number" id="pwpTarget1" value="7" readonly />
          </div>
          <div>
            <label>Target Shift 2</label>
            <input type="number" id="pwpTarget2" value="15" readonly />
          </div>
          <div>
            <label>ACTUAL (total sehari)</label>
            <input type="number" id="pwpActual" placeholder="Isi total PWP" />
          </div>
        </div>
      </div>
    </div>

    <!-- SERTIS -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">KPI Â· <strong>SERTIS</strong></div>
        <span class="badge-kpi">Sertifikasi Struk</span>
      </div>
      <div class="kpi-row">
        <div class="kpi-name">SERTIS</div>
        <div class="grid-2">
          <div>
            <label>Target Shift 1</label>
            <input type="number" id="sertisTarget1" value="9" readonly />
          </div>
          <div>
            <label>Target Shift 2</label>
            <input type="number" id="sertisTarget2" value="12" readonly />
          </div>
          <div>
            <label>ACTUAL (total sehari)</label>
            <input type="number" id="sertisActual" placeholder="Isi total Sertis" />
          </div>
        </div>
      </div>
    </div>

    <!-- PROMO SUEGER -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">KPI Â· <strong>Promo Sueger</strong></div>
        <span class="badge-kpi">Redeem</span>
      </div>
      <div class="kpi-row yellow">
        <div class="kpi-name">PROMO SUEGER</div>
        <div class="grid-2">
          <div>
            <label>Target % ke syarat</label>
            <input type="number" id="suegerTargetPct" value="20" readonly />
          </div>
          <div>
            <label>Struk Bersyarat</label>
            <input type="number" id="suegerBersyarat" placeholder="Struk memenuhi syarat" />
          </div>
          <div>
            <label>Struk Redeem</label>
            <input type="number" id="suegerRedeem" placeholder="Struk redeem" />
          </div>
        </div>
      </div>
    </div>

    <!-- EVOUCHER -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">KPI Â· <strong>Evoucher</strong></div>
        <span class="badge-kpi">Digital Spending</span>
      </div>
      <div class="kpi-row">
        <div class="kpi-name">EVOUCHER</div>
        <div class="grid-2">
          <div>
            <label>Target / Shift (Rp)</label>
            <input type="number" id="evoucherTargetShift" value="5000" readonly />
          </div>
          <div>
            <label>ACTUAL (total sehari, Rp)</label>
            <input type="number" id="evoucherActual" placeholder="Total rupiah evoucher" />
          </div>
        </div>
        <p class="note">
          Target total = Target per shift Ã— 2 shift.
        </p>
      </div>
    </div>

    <!-- NEW MEMBER -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">KPI Â· <strong>New Member</strong></div>
        <span class="badge-kpi">Akuisisi</span>
      </div>
      <div class="kpi-row yellow">
        <div class="kpi-name">NEW MEMBER</div>
        <div class="grid-2">
          <div>
            <label>Target Shift 1</label>
            <input type="number" id="nmTarget1" value="1" readonly />
          </div>
          <div>
            <label>Target Shift 2</label>
            <input type="number" id="nmTarget2" value="1" readonly />
          </div>
          <div>
            <label>ACTUAL (total sehari)</label>
            <input type="number" id="nmActual" placeholder="Isi total NM" />
          </div>
        </div>
      </div>
    </div>

    <!-- TELUR -->
    <div class="card">
      <div class="card-header">
        <div class="card-title">KPI Â· <strong>Telur Ayam Negeri</strong></div>
        <span class="badge-kpi">SKU Fokus</span>
      </div>
      <div class="kpi-row">
        <div class="kpi-name">TELUR AYAM NEGERI</div>
        <div class="grid-2">
          <div>
            <label>Target pack / shift</label>
            <input type="number" id="telurTargetShift" value="1" readonly />
          </div>
          <div>
            <label>ACTUAL (total pack sehari)</label>
            <input type="number" id="telurActual" placeholder="Total pack telur" />
          </div>
        </div>
      </div>
    </div>

    <!-- OUTPUT -->
    <div class="card">
      <div class="card-header">
        <div class="card-title"><strong>Output</strong> Â· Laporan Siap Kirim WA</div>
        <span class="badge-kpi">Shift Report</span>
      </div>

      <div class="status-bar" id="statusSummary">
        <span class="label">Status KPI</span> Â·
        <span>Belum digenerate</span>
      </div>

      <div class="btn-row">
        <button type="button" class="btn-red" onclick="generateLaporan()">
          <span class="icon">âš¡</span>
          <span>Generate Laporan</span>
        </button>
        <button type="button" class="btn-yellow" onclick="copyLaporan()">
          <span class="icon">ðŸ“‹</span>
          <span>Copy Laporan</span>
        </button>
        <button type="button" class="btn-wa" onclick="openWhatsAppGroup()">
          <span class="icon">ðŸŸ¢</span>
          <span>Kirim ke Grup WA</span>
        </button>
      </div>

      <textarea id="output" placeholder="Klik 'Generate Laporan' dulu, lalu copy dan paste di grup WA..."></textarea>
      <p class="note">
        Flow kerja: isi data â†’ klik <strong>Generate Laporan</strong> â†’ klik <strong>Copy</strong> â†’
        klik <strong>Kirim ke Grup WA</strong> â†’ paste di kolom chat.
      </p>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <div class="footer-main">Â© 2025 D&D A DIGITAL CREATIVE STUDIO â€” Retail Tools & Templates</div>
      <div class="footer-sub">Crafted by Brandon Tan</div>
    </div>
  </div>

  <script>
    // THEME TOGGLE
    (function initTheme() {
      const body = document.body;
      const toggle = document.getElementById("themeToggle");
      const label = toggle.querySelector(".mode-label");

      function applyTheme(mode) {
        if (mode === "light") {
          body.classList.remove("dark");
          body.classList.add("light");
          label.textContent = "Light Mode";
        } else {
          body.classList.remove("light");
          body.classList.add("dark");
          label.textContent = "Dark Mode";
        }
      }

      const saved = localStorage.getItem("reportTheme");
      if (saved === "light" || saved === "dark") {
        applyTheme(saved);
      } else {
        applyTheme("dark");
      }

      toggle.addEventListener("click", () => {
        const cur = body.classList.contains("light") ? "light" : "dark";
        const next = cur === "light" ? "dark" : "light";
        applyTheme(next);
        localStorage.setItem("reportTheme", next);
      });
    })();

    function formatTanggalId(value) {
      if (!value) return "";
      const parts = value.split("-");
      if (parts.length !== 3) return value;
      return parts[2] + "-" + parts[1] + "-" + parts[0];
    }

    function hitungKpi(target1, target2, actual) {
      const t1 = Number(target1) || 0;
      const t2 = Number(target2) || 0;
      const act = Number(actual) || 0;
      const targetTotal = t1 + t2;
      let acv = 0;
      if (targetTotal > 0) {
        acv = (act / targetTotal) * 100;
      }
      const acvRounded = Math.round(acv);
      const hutang = acvRounded >= 100 ? "lunas" : "hutang";
      return { t1, t2, act, acvRounded, hutang, targetTotal };
    }

    function generateLaporan() {
      const namaToko = document.getElementById("namaToko").value || "";
      const tanggalRaw = document.getElementById("tanggal").value || "";
      const tanggal = formatTanggalId(tanggalRaw);
      const cos = document.getElementById("cos").value || "";
      const namaKasir = document.getElementById("namaKasir").value || "";
      const ac = document.getElementById("ac").value || "";
      const shift = document.getElementById("shift").value || "";

      // PSM
      const psm = hitungKpi(
        document.getElementById("psmTarget1").value,
        document.getElementById("psmTarget2").value,
        document.getElementById("psmActual").value
      );

      // PWP
      const pwp = hitungKpi(
        document.getElementById("pwpTarget1").value,
        document.getElementById("pwpTarget2").value,
        document.getElementById("pwpActual").value
      );

      // SERTIS
      const sertis = hitungKpi(
        document.getElementById("sertisTarget1").value,
        document.getElementById("sertisTarget2").value,
        document.getElementById("sertisActual").value
      );

      // PROMO SUEGER
      const suegerTargetPct = Number(document.getElementById("suegerTargetPct").value) || 0;
      const suegerBersyarat = Number(document.getElementById("suegerBersyarat").value) || 0;
      const suegerRedeem = Number(document.getElementById("suegerRedeem").value) || 0;
      let suegerAcv = 0;
      if (suegerBersyarat > 0) {
        suegerAcv = (suegerRedeem / suegerBersyarat) * 100;
      }
      const suegerAcvRounded = Math.round(suegerAcv);

      // EVOUCHER
      const evTargetShift = Number(document.getElementById("evoucherTargetShift").value) || 0;
      const evActual = Number(document.getElementById("evoucherActual").value) || 0;
      const evTargetTotal = evTargetShift * 2;
      let evAcv = 0;
      if (evTargetTotal > 0) {
        evAcv = (evActual / evTargetTotal) * 100;
      }
      const evAcvRounded = Math.round(evAcv);

      // NEW MEMBER
      const nm = hitungKpi(
        document.getElementById("nmTarget1").value,
        document.getElementById("nmTarget2").value,
        document.getElementById("nmActual").value
      );

      // TELUR
      const telurTargetShift = Number(document.getElementById("telurTargetShift").value) || 0;
      const telurActual = Number(document.getElementById("telurActual").value) || 0;
      const telurTargetTotal = telurTargetShift * 2;
      let telurAcv = 0;
      if (telurTargetTotal > 0) {
        telurAcv = (telurActual / telurTargetTotal) * 100;
      }
      const telurAcvRounded = Math.round(telurAcv);

      const laporan =
`LAPORAN PERSHIFT
NAMA TOKO  : ${namaToko}
TANGGAL    : ${tanggal}
COS        : ${cos}
NAMA KASIR : ${namaKasir}
AC         : ${ac}
SHIFT      : ${shift}

*PSM*
TARGET SHIFT 1 : ${psm.t1}
TARGET SHIFT 2 : ${psm.t2}
ACTUAL        : ${psm.act}
HUTANG        : ${psm.hutang}
ACV           : ${psm.acvRounded}%

*PWP*
TARGET SHIFT 1 : ${pwp.t1}
TARGET SHIFT 2 : ${pwp.t2}
ACTUAL        : ${pwp.act}
HUTANG        : ${pwp.hutang}
ACV           : ${pwp.acvRounded}%

*SERTIS*
TARGET SHIFT 1 : ${sertis.t1}
TARGET SHIFT 2 : ${sertis.t2}
ACTUAL        : ${sertis.act}
HUTANG        : ${sertis.hutang}
ACV           : ${sertis.acvRounded}%

*PROMO SUEGER*
TARGET ${suegerTargetPct}% TO SYARAT
STRUK BERSYARAT : ${suegerBersyarat}
STRUK REDEEM    : ${suegerRedeem}
ACV%            : ${suegerAcvRounded}%

*EVOUCHER*
TARGET : Rp ${evTargetShift.toLocaleString("id-ID")} /SHIFT
ACTUAL : Rp ${evActual.toLocaleString("id-ID")}
ACV    : ${evAcvRounded}%

*NEW MEMBER*
TARGET SHIFT 1 : ${nm.t1}
TARGET SHIFT 2 : ${nm.t2}
ACTUAL         : ${nm.act}
HUTANG         : ${nm.hutang}
ACV%           : ${nm.acvRounded}%

*TELUR AYAM NEGERI*
TARGET : ${telurTargetShift} PACK/SHIFT
ACTUAL : ${telurActual}
ACV%   : ${telurAcvRounded}%`;

      document.getElementById("output").value = laporan;

      // Ringkasan status KPI di atas
      const statusSummary = document.getElementById("statusSummary");
      const statusPieces = [];

      function pill(text, ok) {
        const cls = ok ? "pill-status lunas" : "pill-status hutang";
        return `<span class="${cls}">${text}</span>`;
      }

      statusPieces.push('<span class="label">Status KPI</span> Â· ');

      statusPieces.push("PSM ");
      statusPieces.push(pill(psm.hutang.toUpperCase(), psm.hutang === "lunas"));
      statusPieces.push(" Â· PWP ");
      statusPieces.push(pill(pwp.hutang.toUpperCase(), pwp.hutang === "lunas"));
      statusPieces.push(" Â· SERTIS ");
      statusPieces.push(pill(sertis.hutang.toUpperCase(), sertis.hutang === "lunas"));
      statusPieces.push(" Â· NM ");
      statusPieces.push(pill(nm.hutang.toUpperCase(), nm.hutang === "lunas"));

      statusSummary.innerHTML = statusPieces.join("");
    }

    async function copyLaporan() {
      const textarea = document.getElementById("output");
      const text = textarea.value || "";
      if (!text.trim()) {
        alert("Belum ada laporan. Klik GENERATE dulu.");
        return;
      }

      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
        } else {
          textarea.select();
          textarea.setSelectionRange(0, 99999);
          document.execCommand("copy");
        }
        alert("Laporan sudah di-copy. Tinggal paste di WA.");
      } catch (e) {
        console.error(e);
        textarea.select();
        textarea.setSelectionRange(0, 99999);
        document.execCommand("copy");
        alert("Clipboard tidak mendukung penuh. Laporan sudah diseleksi, silakan copy manual.");
      }
    }

    function openWhatsAppGroup() {
      const url = "https://chat.whatsapp.com/IQcVASSrOnwLsqWKSP4agt?mode=hqrc";
      window.open(url, "_blank");
    }
  </script>
</body>
</html>
